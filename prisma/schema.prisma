generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model countries {
  id             Int              @id @default(autoincrement())
  name           String           @unique @db.VarChar(64)
  code           Int              @unique
  municipalities municipalities[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model subjects {
  id        BigInt      @id @default(autoincrement())
  name      String      @db.VarChar(256)
  type      String      @db.Char(1)
  merchants merchants[]
  users     users[]
}

model users {
  id             BigInt           @id @default(autoincrement())
  email          String           @unique @db.VarChar(256)
  password       String           @db.VarChar(255)
  subject_id     BigInt
  role_id        Int
  establishments establishments[]
  merchants      merchants[]
  roles          roles            @relation(fields: [role_id], references: [id], onUpdate: NoAction)
  subjects       subjects         @relation(fields: [subject_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model merchants {
  id              BigInt           @id @default(autoincrement())
  email           String?          @unique @db.VarChar(256)
  phone           String?          @unique @db.VarChar(10)
  registered_at   DateTime         @default(now()) @db.Timestamp(6)
  updated_at      DateTime         @default(now()) @db.Timestamp(6)
  status_id       Int
  subject_id      BigInt
  municipality_id Int
  updater_id      BigInt
  establishments  establishments[]
  municipalities  municipalities   @relation(fields: [municipality_id], references: [id], onUpdate: NoAction)
  statuses        statuses         @relation(fields: [status_id], references: [id], onUpdate: NoAction)
  subjects        subjects         @relation(fields: [subject_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users           users            @relation(fields: [updater_id], references: [id], onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model establishments {
  id         BigInt    @id @default(autoincrement())
  name       String    @db.VarChar(128)
  income     Decimal   @db.Decimal(13, 2)
  employees  Int       @default(0)
  owner_id   BigInt
  updated_at DateTime  @default(now()) @db.Timestamp(6)
  updated_by BigInt
  merchants  merchants @relation(fields: [owner_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [updated_by], references: [id], onUpdate: NoAction)
}

model MerchantView {
  id                              BigInt
  email                           String?
  phone                           String?
  registered_at                   DateTime?
  status_name                     String?
  subject_name                    String?
  municipality_name               String?
  country_name                    String?
  country_code                    String?
  user_email                      String?
  user_role                       String?
  user_subject_name               String?
  establishment_id                BigInt?
  establishment_name              String?
  income                          Decimal?
  employees                       Int?
  updated_at                      DateTime?
  establishment_user_email        String?
  establishment_user_subject_name String?
  establishment_user_role         String?

  @@ignore
}

model municipalities {
  id         Int         @id @default(autoincrement())
  name       String      @db.VarChar(64)
  country_id Int
  merchants  merchants[]
  countries  countries   @relation(fields: [country_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model roles {
  id          Int     @id @default(autoincrement())
  name        String  @unique @db.VarChar(32)
  description String? @default("sin descripcion") @db.VarChar(500)
  users       users[]
}

model statuses {
  id        Int         @id @default(autoincrement())
  name      String      @unique @db.VarChar(32)
  merchants merchants[]
}
